<?xml version='1.1' encoding='UTF-8'?>
<project>
  <actions/>
  <description></description>
  <keepDependencies>false</keepDependencies>
  <properties>
    <io.jenkins.plugins.DingTalkJobProperty plugin="dingding-notifications@2.4.10">
      <notifierConfigs>
        <io.jenkins.plugins.DingTalkNotifierConfig>
          <checked>true</checked>
          <robotId>bf53f8ff-8df3-46f9-860c-cd22c6d01feb</robotId>
          <robotName>jenkins</robotName>
          <atAll>true</atAll>
          <atMobile></atMobile>
          <content></content>
          <noticeOccasions>
            <string>SUCCESS</string>
            <string>START</string>
            <string>NOT_BUILT</string>
            <string>ABORTED</string>
            <string>FAILURE</string>
            <string>UNSTABLE</string>
          </noticeOccasions>
        </io.jenkins.plugins.DingTalkNotifierConfig>
      </notifierConfigs>
    </io.jenkins.plugins.DingTalkJobProperty>
    <hudson.model.ParametersDefinitionProperty>
      <parameterDefinitions>
        <hudson.model.ChoiceParameterDefinition>
          <name>PRO_NAME</name>
          <choices class="java.util.Arrays$ArrayList">
            <a class="string-array">
              <string>Trunk</string>
            </a>
          </choices>
        </hudson.model.ChoiceParameterDefinition>
        <hudson.model.ChoiceParameterDefinition>
          <name>Platform</name>
          <choices class="java.util.Arrays$ArrayList">
            <a class="string-array">
              <string>iOS</string>
              <string>Android</string>
              <string>WebGL</string>
              <string>Windows</string>
            </a>
          </choices>
        </hudson.model.ChoiceParameterDefinition>
        <hudson.model.ChoiceParameterDefinition>
          <name>SvnUpdateType</name>
          <choices class="java.util.Arrays$ArrayList">
            <a class="string-array">
              <string>None</string>
              <string>UpdateNoRevert</string>
              <string>UpdateAndRevert</string>
            </a>
          </choices>
        </hudson.model.ChoiceParameterDefinition>
        <hudson.model.BooleanParameterDefinition>
          <name>RemoveManifest</name>
          <description>是否删除资源清单</description>
          <defaultValue>true</defaultValue>
        </hudson.model.BooleanParameterDefinition>
        <hudson.model.BooleanParameterDefinition>
          <name>BuildRes</name>
          <description>是否构建资源</description>
          <defaultValue>false</defaultValue>
        </hudson.model.BooleanParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>ResVer</name>
          <description>资源版本号</description>
          <defaultValue>1.0.0.1</defaultValue>
          <trim>true</trim>
        </hudson.model.StringParameterDefinition>
        <hudson.model.BooleanParameterDefinition>
          <name>IsBuildPkg</name>
          <description>//构建安装包或者导出xcode或者webgl工程</description>
          <defaultValue>false</defaultValue>
        </hudson.model.BooleanParameterDefinition>
        <hudson.model.ChoiceParameterDefinition>
          <name>BuildPkgType</name>
          <choices class="java.util.Arrays$ArrayList">
            <a class="string-array">
              <string>IOS</string>
            </a>
          </choices>
        </hudson.model.ChoiceParameterDefinition>
        <hudson.model.BooleanParameterDefinition>
          <name>IsDebug</name>
          <description>是否切换到测试模式</description>
          <defaultValue>true</defaultValue>
        </hudson.model.BooleanParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>VersionName</name>
          <description>App版本号</description>
          <defaultValue>1.0.0</defaultValue>
          <trim>false</trim>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>VersionCode</name>
          <description>App版本Code</description>
          <defaultValue>1</defaultValue>
          <trim>false</trim>
        </hudson.model.StringParameterDefinition>
        <hudson.model.ChoiceParameterDefinition>
          <name>PkgType</name>
          <description>AllRes 安装包包含所有资源
NoRes安装包包含不包含资源
HalfRes安装包包含包含部分资源</description>
          <choices class="java.util.Arrays$ArrayList">
            <a class="string-array">
              <string>AllRes</string>
              <string>NoRes</string>
              <string>HalfRes</string>
            </a>
          </choices>
        </hudson.model.ChoiceParameterDefinition>
        <hudson.model.BooleanParameterDefinition>
          <name>OnlyBuildProject</name>
          <description>只编译工程，不重新导出</description>
          <defaultValue>false</defaultValue>
        </hudson.model.BooleanParameterDefinition>
        <hudson.model.BooleanParameterDefinition>
          <name>UseIL2CPP</name>
          <description>将脚本端切换到IL2CPP，否为mono</description>
          <defaultValue>false</defaultValue>
        </hudson.model.BooleanParameterDefinition>
        <hudson.model.BooleanParameterDefinition>
          <name>BuildPatch</name>
          <description>构建补丁</description>
          <defaultValue>false</defaultValue>
        </hudson.model.BooleanParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>AbdetailVer</name>
          <description>基础资源清单存放目录</description>
          <defaultValue>1_baseVer</defaultValue>
          <trim>false</trim>
        </hudson.model.StringParameterDefinition>
        <hudson.model.BooleanParameterDefinition>
          <name>ABNameWithHash</name>
          <description>生成的补丁，ab资源名称是否需要待遇hash值，目前只有webgl需要勾选</description>
          <defaultValue>false</defaultValue>
        </hudson.model.BooleanParameterDefinition>
        <hudson.model.BooleanParameterDefinition>
          <name>StripEngineCode</name>
          <description>是否裁剪引擎代码</description>
          <defaultValue>false</defaultValue>
        </hudson.model.BooleanParameterDefinition>
        <hudson.model.ChoiceParameterDefinition>
          <name>StripLvl</name>
          <description>代码裁剪等级</description>
          <choices class="java.util.Arrays$ArrayList">
            <a class="string-array">
              <string>Disabled</string>
              <string>Low</string>
              <string>Medium</string>
              <string>High</string>
            </a>
          </choices>
        </hudson.model.ChoiceParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>OutputPath</name>
          <description>导出路径（app工程导出路径）空值有代码指定</description>
          <trim>true</trim>
        </hudson.model.StringParameterDefinition>
        <hudson.model.ChoiceParameterDefinition>
          <name>AssetLoadType</name>
          <description>WEBGL首包资源存放在CDN：0, 本地：1</description>
          <choices class="java.util.Arrays$ArrayList">
            <a class="string-array">
              <string>PKG</string>
              <string>CDN</string>
            </a>
          </choices>
        </hudson.model.ChoiceParameterDefinition>
        <hudson.model.ChoiceParameterDefinition>
          <name>Identify</name>
          <description>Identify</description>
          <choices class="java.util.Arrays$ArrayList">
            <a class="string-array">
              <string>trunk</string>
            </a>
          </choices>
        </hudson.model.ChoiceParameterDefinition>
      </parameterDefinitions>
    </hudson.model.ParametersDefinitionProperty>
  </properties>
  <scm class="hudson.scm.NullSCM"/>
  <assignedNode>Mac_jokeyssiii</assignedNode>
  <canRoam>false</canRoam>
  <disabled>false</disabled>
  <blockBuildWhenDownstreamBuilding>false</blockBuildWhenDownstreamBuilding>
  <blockBuildWhenUpstreamBuilding>false</blockBuildWhenUpstreamBuilding>
  <triggers/>
  <concurrentBuild>false</concurrentBuild>
  <customWorkspace>/Users/TGSW_del/</customWorkspace>
  <builders>
    <org.jenkinsci.plugins.conditionalbuildstep.ConditionalBuilder plugin="conditional-buildstep@1.4.2">
      <runner class="org.jenkins_ci.plugins.run_condition.BuildStepRunner$Fail" plugin="run-condition@1.5"/>
      <runCondition class="org.jenkins_ci.plugins.run_condition.logic.Not" plugin="run-condition@1.5">
        <condition class="org.jenkins_ci.plugins.run_condition.core.BooleanCondition">
          <token>${OnlyBuildProject}</token>
        </condition>
      </runCondition>
      <conditionalbuilders>
        <hudson.tasks.Shell>
          <command>who
echo ================
PROJ_PATH=$WORKSPACE/$PRO_NAME/shengwang
SVN_USERNAME=taigu1build
SVN_USERPWD=123456
SVNCMD=/opt/homebrew/bin/svn
if [ $SvnUpdateType = UpdateAndRevert ];then
	cd $PROJ_PATH
    $SVNCMD cleanup --username=$SVN_USERNAME --password=$SVN_USERPWD
    $SVNCMD revert --username=$SVN_USERNAME --password=$SVN_USERPWD -R .
    $SVNCMD update --username=$SVN_USERNAME --password=$SVN_USERPWD
elif [ $SvnUpdateType = UpdateNoRevert ];then
	cd $PROJ_PATH
    $SVNCMD cleanup --username=$SVN_USERNAME --password=$SVN_USERPWD.
    $SVNCMD update --username=$SVN_USERNAME --password=$SVN_USERPWD
fi

PROJ_PATH=$WORKSPACE/$PRO_NAME/shengwang
XCODE_PROJECT_PATH=$WORKSPACE/$PRO_NAME/xcodeproject
OUT_PUT_DIR=$HOME/Desktop/Build/iOS


rm -rf $PROJ_PATH/BuildLog
rm -rf $OUT_PUT_DIR
rm -rf $PROJ_PATH/Library/ScriptAssemblies/*
rm -rf $PROJ_PATH/Assets/Script/*
rm -rf $XCODE_PROJECT_PATH

mkdir -p $OUT_PUT_DIR
mkdir -p $XCODE_PROJECT_PATH

HOTFIX_LINKING=$PROJ_PATH/Assets/hotfix
HOTFIX_PROJ=$PROJ_PATH/hotfix/hotfix/iLScript
if [ ! -d $HOTFIX_LINKING ];then
	ln -s $HOTFIX_PROJ $HOTFIX_LINKING
fi
cd $PROJ_PATH/hotfix</command>
          <configuredLocalRules/>
        </hudson.tasks.Shell>
        <org.jenkinsci.plugins.unity3d.Unity3dBuilder plugin="unity3d-plugin@1.3">
          <unity3dName>unity20180436</unity3dName>
          <argLine>-projectPath ${WORKSPACE}/${PRO_NAME}/shengwang -nographics -batchMode -disable-assembly-updater -executeMethod Jenkins.JenkinsBuild.BuildMain -quit -batchmode  -buildTarget ${Platform}  -logFile ${WORKSPACE}/${PRO_NAME}/shengwang/BuildLog/build_android.log ABNameWithHash $ABNameWithHash StripLvl $StripLvl StripEngineCode $StripEngineCode UseIL2CPP $UseIL2CPP AssetLoadType $AssetLoadType BuildPatch $BuildPatch AbdetailVer $AbdetailVer Platform $Platform BuildRes $BuildRes ResVer $ResVer IsDebug $IsDebug BuildPkgType $BuildPkgType IsBuildPkg $IsBuildPkg VersionName $VersionName VersionCode $VersionCode  PkgType $PkgType OutputPath $OutputPath RemoveManifest $RemoveManifest</argLine>
          <unstableReturnCodes></unstableReturnCodes>
        </org.jenkinsci.plugins.unity3d.Unity3dBuilder>
      </conditionalbuilders>
    </org.jenkinsci.plugins.conditionalbuildstep.ConditionalBuilder>
    <org.jenkinsci.plugins.conditionalbuildstep.singlestep.SingleConditionalBuilder plugin="conditional-buildstep@1.4.2">
      <condition class="org.jenkins_ci.plugins.run_condition.core.BooleanCondition" plugin="run-condition@1.5">
        <token>${IsBuildPkg}</token>
      </condition>
      <buildStep class="hudson.tasks.Shell">
        <command>XCODE_PROJECT_PATH=$WORKSPACE/$PRO_NAME/xcodeproject
OUT_PUT_DIR=$HOME/Desktop/Build/iOS
mkdir -p $OUT_PUT_DIR

RELEASE_DIR=$WORKSPACE/www/$PRO_NAME/

security unlock-keychain -p &quot;111111&quot; ~/Library/Keychains/login.keychain
cd $XCODE_PROJECT_PATH
xcodebuild

IPA_NAME_PREFIX=$Identify
if [ $IsDebug ];then
IPA_NAME_PREFIX=$Identify&quot;_&quot;&quot;debug&quot;
else
IPA_NAME_PREFIX=$Identify&quot;_&quot;&quot;release&quot;
fi
ipa_name=&quot;$BUILD_NUMBER&quot;&quot;_&quot;&quot;$IPA_NAME_PREFIX&quot;&quot;_&quot;&quot;$PkgType&quot;&quot;_&quot;&quot;$VersionName&quot;&quot;_&quot;&quot;$VersionCode&quot;&quot;.ipa&quot;
xcrun -sdk iphoneos PackageApplication -v ${XCODE_PROJECT_PATH}/build/Release-iphoneos/*.app -o ${OUT_PUT_DIR}/${ipa_name}

cd $OUT_PUT_DIR
mv $ipa_name $RELEASE_DIR/
</command>
        <configuredLocalRules/>
      </buildStep>
      <runner class="org.jenkins_ci.plugins.run_condition.BuildStepRunner$Fail" plugin="run-condition@1.5"/>
    </org.jenkinsci.plugins.conditionalbuildstep.singlestep.SingleConditionalBuilder>
    <org.jenkinsci.plugins.conditionalbuildstep.singlestep.SingleConditionalBuilder plugin="conditional-buildstep@1.4.2">
      <condition class="org.jenkins_ci.plugins.run_condition.core.BooleanCondition" plugin="run-condition@1.5">
        <token>${BuildPatch}</token>
      </condition>
      <buildStep class="hudson.tasks.Shell">
        <command>PROJ_PATH=$WORKSPACE/$PRO_NAME/shengwang
RELEASE_DIR=$WORKSPACE/www/$PRO_NAME/patch
mkdir -p $RELEASE_DIR
OUT_PUT_DIR=$PROJ_PATH/PatchBuild
NEW_PATCH_NAME=&quot;$BUILD_NUMBER&quot; &quot;_&quot;&quot;$Identify&quot;_ios_1.0.&quot;${Subversion}&quot;&quot;.zip&quot;

cd $OUT_PUT_DIR
zip tmp_batch.zip Res/* UpdateInfo.txt VersionInfo.txt

cp tmp_batch.zip $RELEASE_DIR/$NEW_PATCH_NAME

</command>
        <configuredLocalRules/>
      </buildStep>
      <runner class="org.jenkins_ci.plugins.run_condition.BuildStepRunner$Fail" plugin="run-condition@1.5"/>
    </org.jenkinsci.plugins.conditionalbuildstep.singlestep.SingleConditionalBuilder>
  </builders>
  <publishers/>
  <buildWrappers>
    <hudson.plugins.timestamper.TimestamperBuildWrapper plugin="timestamper@1.21"/>
    <org.jenkinsci.plugins.buildnamesetter.BuildNameSetter plugin="build-name-setter@2.2.0">
      <template>#${BUILD_NUMBER}-${SvnUpdateType}-BuildRes:${BuildRes}-ResVer:${ResVer}-IsBuildPkg:${IsBuildPkg}(${VersionName}-${VersionCode},${PkgType}-IsDebug:${IsDebug}-${BuildPkgType})-BuildPatch:${BuildPatch}(${AbdetailVer})</template>
      <descriptionTemplate>q#${BUILD_NUMBER}-BuildRes:${BuildRes}(${ResVer})-IsBuildPkg:${IsBuildPkg}(${VersionName,${PkgType},${VersionCode}})</descriptionTemplate>
      <runAtStart>true</runAtStart>
      <runAtEnd>true</runAtEnd>
    </org.jenkinsci.plugins.buildnamesetter.BuildNameSetter>
  </buildWrappers>
</project>