// GENERATED BY UNITY. REMOVE THIS COMMENT TO PREVENT OVERWRITING WHEN EXPORTING AGAIN

buildscript {
    repositories {
        google()
        jcenter()
    }

    dependencies {
        //classpath 'com.android.tools.build:gradle:2.1.0'
//        classpath 'com.android.tools.build:gradle:7.0.0'
        classpath 'com.android.tools.build:gradle:4.0.2'
    }
}

allprojects {
    repositories {
        google()
        jcenter()
        flatDir {
            dirs 'libs'
            dirs 'channelLibs/korea'
        }
    }
}

apply plugin: 'com.android.application'

dependencies {
    implementation fileTree(include: ['*.jar',"*.aar"], dir: 'libs')
    //根据不同渠道链接不同jar
    android.productFlavors.all { flavor ->
        implementation fileTree(dir: 'channelLibs/' + flavor.name, include: ['*.jar'])
    }
    implementation "com.android.support:appcompat-v7:28.0.0"
    implementation 'com.android.support:design:28.0.0'
    implementation 'com.android.support.constraint:constraint-layout:1.1.3'
    implementation 'com.google.android.play:core:1.10.0'
}


static def MyBuildTime() {
    return new Date().format("yyyy-MM-dd", TimeZone.getDefault())//包含时分秒
}
android {
    def pFile = file("game.properties")
    def loadProperties = {
        Properties p = new Properties()
        pFile.withInputStream { stream ->
            p.load(stream)
        }

        defaultConfig {
            versionName = p.get('versionName')
            versionCode = p.get('versionCode').toInteger()
        }

        packagingOptions {
            exclude 'lib/armeabi/**'
            //exclude 'lib/armeabi-v7a/**'
            //exclude 'lib/arm64-v8a/**'
            exclude 'lib/mips/**'
            exclude 'lib/mips64/**'
            exclude 'lib/x86/**'
            exclude 'lib/x86_64/**'
        }
    }
    assetPacks = [":install_time_asset_pack"]
    compileSdkVersion 30
    buildToolsVersion '29.0.2'
    useLibrary 'org.apache.http.legacy'

    //通用配置
    defaultConfig {
        //multiDexEnabled true //金立单接时需要，否则支付宝的jar编译不过去
        minSdkVersion 26
        targetSdkVersion 30
        //通过unity生成的配置文件读取version一类的信息
        loadProperties()
        flavorDimensions "versionCode"
    }


    bundle {
        language {
            enableSplit = false
        }
        density {
            enableSplit = true
        }
        abi {
            enableSplit = true
        }
    }
    lintOptions {
        abortOnError false
    }

    //签名
    signingConfigs {
        release {
            storeFile file("bingougame.jks")
            storePassword "Bingou123456"
            keyAlias "game"
            keyPassword "Bingou123456"
        }

        buildTypes {
//            debug {
//                jniDebuggable true
//            }
            release {
                minifyEnabled false
                //useProguard false
                proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-unity.txt'
                signingConfig signingConfigs.release

                //ndk 平台过滤
//                ndk {
//                    android.productFlavors.all { flavor ->
//                        if(flavor.equals('sdkSample')){
//                            abiFilters "armeabi-v7a", "armeabi"
//                        }
//
//                    }
//                }
            }
        }


        productFlavors {

//            local {
//                manifestPlaceholders = ["channel_id": "local_channel"]
//            }

//            sdkSample {
//                applicationId "com.bingougame.tgsw.sdkSample"
//                manifestPlaceholders = ["channel_id": "sample_channel"]
//            }
//            chujian{
//               //applicationId "com.bingougame.tgsw.chujian"
//              manifestPlaceholders = ["channel_id": "92504f729bda4862"]
//            }

//             cs9377{
//                  applicationId "com.shenwangxianyu.com.cs9377"
//             }

//             qiyu{
//                 applicationId "com.cjgame.qytx.zscx"
//             }

//             kuaiwan{
//                 applicationId "com.bg.tgsw.kw9665"
//             }

            //jinli {
            //    applicationId "com.bingougame.tgsw.am"
            //}
                korea {
                    applicationId "com.longtukorea.ancientgod"
                }
        }

        //apk输出设置
//        applicationVariants.all {
//
//            com.android.build.gradle.api.ApplicationVariant variant ->
//                for (flavor in variant.productFlavors) {
//                    println("$project.buildDir")
//                    def YourNewPath = "output"
//                    def YourNewApkName = project.name + "_" + flavor.name + "_" + versionName
//                    variant.outputs[0].outputFile = file("$project.rootDir/${YourNewPath}/${YourNewApkName}.apk")
//                }
//        }

        applicationVariants.all { variant ->//批量修改Apk名字
            variant.outputs.all { output ->
                //要被替换的源字符串
                def outputFile = output.outputFile
                if (outputFile != null && outputFile.name.endsWith('.apk')) {
                    // 输出apk名称为ForWatch_v1.1(2)_2016-09-28_15-54-35.apk
                    def version = "v${versionName}-${versionCode}"
                    def endIndex = outputFile.name.indexOf('.apk')
                    def apkName = outputFile.name.substring(0, endIndex);
                    def fileName = "${apkName}_${version}_${MyBuildTime()}.apk"
                    outputFileName = fileName
                }
            }
        }
    }

}
